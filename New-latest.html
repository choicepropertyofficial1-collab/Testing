<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choice Properties - Professional Rental Application</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============================================
           CSS VARIABLES & RESET
           ============================================ */
        :root {
            --primary: #1a5276;
            --primary-dark: #154360;
            --secondary: #3498db;
            --accent: #e67e22;
            --accent-dark: #d35400;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray: #7f8c8d;
            --gray-light: #ecf0f1;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --border-radius: 10px;
            --border-radius-sm: 6px;
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* ============================================
           HEADER & BRANDING
           ============================================ */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 40px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .brand-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
            z-index: 2;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            background: var(--accent);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(230, 126, 34, 0.3);
        }

        .logo-icon i {
            font-size: 24px;
            color: white;
        }

        .logo-text {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .logo-subtext {
            font-size: 14px;
            opacity: 0.9;
            margin-left: 65px;
            margin-top: -5px;
        }

        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .confidential-stamp {
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .time-estimate {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        /* ============================================
           PROGRESS INDICATOR
           ============================================ */
        .progress-container {
            background: white;
            padding: 25px 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin: 25px 0;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--gray-light);
            z-index: 1;
            border-radius: 4px;
        }

        .progress-fill {
            position: absolute;
            top: 25px;
            left: 0;
            height: 8px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            z-index: 2;
            border-radius: 4px;
            transition: var(--transition);
            width: 0%;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
            flex: 1;
            min-width: 80px;
        }

        .step-number {
            background: white;
            color: var(--gray);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            border: 3px solid var(--gray-light);
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .step-label {
            margin-top: 12px;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray);
            text-align: center;
            transition: var(--transition);
            max-width: 100px;
            line-height: 1.4;
        }

        .progress-step.active .step-number {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .progress-step.active .step-label {
            color: var(--secondary);
            font-weight: 700;
        }

        .progress-step.completed .step-number {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        /* ============================================
           FORM CONTAINER
           ============================================ */
        .form-container {
            background: white;
            padding: 40px;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        .form-section {
            display: none;
            animation: fadeSlideIn 0.4s ease-out;
        }

        .form-section.active {
            display: block;
        }

        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================
           TYPOGRAPHY
           ============================================ */
        h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 28px;
        }

        h2 i {
            color: var(--accent);
            background: rgba(230, 126, 34, 0.1);
            padding: 12px;
            border-radius: 12px;
        }

        h3 {
            color: var(--secondary);
            margin: 25px 0 20px;
            padding-left: 15px;
            border-left: 4px solid var(--secondary);
            font-size: 20px;
        }

        /* ============================================
           FORM ELEMENTS
           ============================================ */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 15px;
        }

        .required::after {
            content: " *";
            color: var(--danger);
        }

        .required-note {
            background: rgba(231, 76, 60, 0.1);
            padding: 15px;
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid var(--danger);
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        input.error, select.error, textarea.error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2);
        }

        .form-row {
            display: flex;
            gap: 25px;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
        }

        /* ============================================
           CHECKBOXES & RADIOS
           ============================================ */
        .checkbox-group, .radio-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 10px;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
        }

        .checkbox-group:hover, .radio-group:hover {
            background: var(--gray-light);
        }

        .checkbox-group input, .radio-group input {
            width: auto;
            transform: scale(1.2);
        }

        /* ============================================
           NOTICES & ALERTS
           ============================================ */
        .notice-box {
            background: #e8f4fc;
            border-left: 4px solid var(--secondary);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        }

        .legal-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            border: 1px solid var(--gray-light);
        }

        /* ============================================
           BUTTONS
           ============================================ */
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid var(--gray-light);
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
            justify-content: center;
        }

        .btn-prev {
            background: var(--gray-light);
            color: var(--dark);
        }

        .btn-prev:hover:not(:disabled) {
            background: #dee2e6;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-next, .btn-submit {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-next:hover:not(:disabled), .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--success) 0%, #2ecc71 100%);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ============================================
           ERROR & SUCCESS MESSAGES
           ============================================ */
        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 8px;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .success-message {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            padding: 40px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            text-align: center;
            display: none;
            box-shadow: var(--shadow);
        }

        .success-message i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--success);
        }

        /* ============================================
           FILE UPLOAD
           ============================================ */
        .file-upload-area {
            border: 3px dashed var(--gray-light);
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .file-upload-area:hover {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.1);
        }

        .file-upload-icon {
            font-size: 48px;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .file-upload-hint {
            font-size: 14px;
            color: var(--gray);
            margin-top: 10px;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--gray-light);
            border-radius: var(--border-radius-sm);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .file-item:hover {
            background: #e0e0e0;
        }

        .file-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .file-icon {
            color: var(--danger);
            font-size: 18px;
        }

        .file-name {
            font-weight: 500;
        }

        .file-size {
            color: var(--gray);
            font-size: 14px;
        }

        .file-remove {
            color: var(--danger);
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .file-remove:hover {
            background: rgba(231, 76, 60, 0.1);
        }

        /* ============================================
           CO-APPLICANT SECTION
           ============================================ */
        .co-applicant-section {
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            background: var(--gray-light);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .co-applicant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .add-co-applicant {
            background: var(--gray-light);
            border: 2px dashed var(--gray);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 25px;
        }

        .add-co-applicant:hover {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }

        /* ============================================
           SUMMARY SECTION
           ============================================ */
        .summary-section {
            background: var(--gray-light);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
        }

        .summary-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .summary-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 15px;
        }

        .summary-value {
            color: #555;
            line-height: 1.5;
        }

        /* ============================================
           PAYMENT SECTION
           ============================================ */
        .payment-section {
            background: var(--gray-light);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 25px 0;
        }

        .payment-options {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .payment-option {
            flex: 1;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: white;
        }

        .payment-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .payment-option.selected {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }

        .payment-option i {
            font-size: 32px;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        /* ============================================
           SAVE PROGRESS
           ============================================ */
        .save-progress {
            text-align: center;
            margin: 30px 0;
        }

        .save-progress-btn {
            background: linear-gradient(135deg, #6c757d 0%, #868e96 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        /* ============================================
           UTILITY CLASSES
           ============================================ */
        .field-hint {
            font-size: 13px;
            color: var(--gray);
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .character-count {
            font-size: 13px;
            color: var(--gray);
            text-align: right;
            margin-top: 8px;
        }

        .character-count.warning {
            color: var(--warning);
        }

        .character-count.error {
            color: var(--danger);
        }

        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 3px solid var(--gray-light);
            border-top-color: var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* ============================================
           FOOTER
           ============================================ */
        footer {
            text-align: center;
            padding: 25px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid var(--gray-light);
            margin-top: 40px;
        }

        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */
        @media (max-width: 992px) {
            .container {
                padding: 10px;
            }
            
            .form-container {
                padding: 30px;
            }
            
            .payment-options {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 25px;
            }
            
            .logo-text {
                font-size: 24px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .form-col {
                margin-bottom: 20px;
            }
            
            .btn-container {
                flex-direction: column;
                gap: 15px;
            }
            
            button {
                width: 100%;
            }
            
            .progress-bar {
                flex-wrap: wrap;
                gap: 20px;
            }
            
            .progress-step {
                flex: 1 0 calc(33.333% - 20px);
            }
            
            h2 {
                font-size: 24px;
            }
            
            h3 {
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .form-container {
                padding: 20px;
            }
            
            .progress-step {
                flex: 1 0 calc(50% - 20px);
            }
            
            .header-actions {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="brand-container">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div>
                        <div class="logo-text">Choice Properties</div>
                        <div class="logo-subtext">Professional Property Management Solutions</div>
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="confidential-stamp">
                        <i class="fas fa-lock"></i>
                        <span>CONFIDENTIAL & SECURE â€¢ ENCRYPTED TRANSMISSION</span>
                    </div>
                    
                    <div class="time-estimate">
                        <i class="fas fa-clock"></i>
                        <div>
                            <div>Estimated completion: <strong>15-20 minutes</strong></div>
                            <div style="font-size: 12px; opacity: 0.9;">Auto-saves every 30 seconds</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
                <div class="progress-step completed" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Property & Applicant Info</div>
                </div>
                <div class="progress-step active" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Residency & Occupancy</div>
                </div>
                <div class="progress-step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Employment & Income</div>
                </div>
                <div class="progress-step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-label">Financial & References</div>
                </div>
                <div class="progress-step" id="step5">
                    <div class="step-number">5</div>
                    <div class="step-label">Review & Submit</div>
                </div>
            </div>
        </div>

        <div class="form-container">
            <!-- Success Message (hidden by default) -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i>
                <h2>Application Submitted Successfully!</h2>
                <div class="application-id" id="applicationIdDisplay"></div>
                <p style="margin: 20px 0;">Thank you for choosing Choice Properties. We have received your rental application and will review it carefully.</p>
                <p style="margin-bottom: 30px; color: #555;">You will receive a confirmation email within 10 minutes. Please check your spam folder if you don't see it.</p>
                <div class="success-actions">
                    <button class="btn-next" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Summary
                    </button>
                    <button class="btn-submit" onclick="window.location.reload()" style="margin-left: 15px;">
                        <i class="fas fa-plus"></i> New Application
                    </button>
                </div>
            </div>

            <!-- Main Application Form -->
            <form id="rentalApplication" novalidate>
                <!-- Section 1: Property & Applicant Information -->
                <div class="form-section active" id="section1">
                    <h2><i class="fas fa-home"></i> Property & Applicant Information</h2>
                    
                    <div class="required-note">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Fields marked with * are required. All information is kept confidential.</span>
                    </div>
                    
                    <div class="legal-box">
                        <h3><i class="fas fa-shield-alt"></i> Privacy & Equal Housing Notice</h3>
                        <p>Choice Properties is committed to equal housing opportunity and fully complies with the Federal Fair Housing Act. We do not discriminate based on race, color, religion, sex, national origin, familial status, disability, or any other protected class.</p>
                        <p>All personal information is encrypted and used solely for rental screening purposes in compliance with FCRA regulations.</p>
                    </div>
                    
                    <h3>Property Details</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="propertyAddress" class="required">Property Address</label>
                            <input type="text" id="propertyAddress" name="propertyAddress" 
                                   placeholder="123 Main Street, City, State" required
                                   data-validation="address">
                            <div class="error-message" id="propertyAddressError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid property address
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="unitNumber">Unit / Apartment Number</label>
                            <input type="text" id="unitNumber" name="unitNumber" 
                                   placeholder="Apt 4B, Suite 100, etc.">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="moveInDate" class="required">Requested Move-In Date</label>
                            <input type="date" id="moveInDate" name="moveInDate" 
                                   min="" required
                                   data-validation="future-date">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Must be at least 3 days from today
                            </div>
                            <div class="error-message" id="moveInDateError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please select a valid move-in date
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="leaseTerm" class="required">Lease Term</label>
                            <select id="leaseTerm" name="leaseTerm" required>
                                <option value="">Select Term</option>
                                <option value="6 months">6 Months</option>
                                <option value="12 months" selected>12 Months</option>
                                <option value="18 months">18 Months</option>
                                <option value="24 months">24 Months</option>
                                <option value="month-to-month">Month-to-Month</option>
                            </select>
                            <div class="error-message" id="leaseTermError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please select a lease term
                            </div>
                        </div>
                    </div>
                    
                    <h3>Primary Applicant Information</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="fullName" class="required">Full Legal Name</label>
                            <input type="text" id="fullName" name="fullName" 
                                   placeholder="John A. Smith" required
                                   data-validation="name">
                            <div class="error-message" id="fullNameError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your full legal name
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="dob" class="required">Date of Birth</label>
                            <input type="date" id="dob" name="dob" 
                                   max="" required
                                   data-validation="adult">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Must be 18 years or older
                            </div>
                            <div class="error-message" id="dobError">
                                <i class="fas fa-exclamation-circle"></i>
                                Must be 18 years or older
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="dlNumber" class="required">Driver's License / State ID Number</label>
                            <input type="text" id="dlNumber" name="dlNumber" 
                                   placeholder="D12345678" required
                                   data-validation="dl">
                            <div class="error-message" id="dlNumberError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid ID number
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="dlState" class="required">Issuing State</label>
                            <select id="dlState" name="dlState" required>
                                <option value="">Select State</option>
                            </select>
                            <div class="error-message" id="dlStateError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please select issuing state
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="phone" class="required">Primary Phone Number</label>
                            <input type="tel" id="phone" name="phone" 
                                   placeholder="(555) 123-4567" required
                                   data-validation="phone" maxlength="14">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                10 digits required. Format: (XXX) XXX-XXXX
                            </div>
                            <div class="error-message" id="phoneError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid 10-digit phone number
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="email" class="required">Email Address</label>
                            <input type="email" id="email" name="email" 
                                   placeholder="your.email@example.com" required
                                   data-validation="email">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Confirmation will be sent to this email
                            </div>
                            <div class="error-message" id="emailError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid email address
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="maritalStatus">Marital Status</label>
                            <select id="maritalStatus" name="maritalStatus">
                                <option value="">Select Status</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Widowed">Widowed</option>
                                <option value="Separated">Separated</option>
                                <option value="Domestic Partnership">Domestic Partnership</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="ssn">Social Security Number (Last 4 digits)</label>
                            <input type="text" id="ssn" name="ssn" 
                                   placeholder="XXXX" maxlength="4"
                                   data-validation="ssn">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Optional - Used for credit check verification
                            </div>
                        </div>
                    </div>
                    
                    <h3>Identity Verification</h3>
                    <div class="form-group">
                        <label for="idVerification" class="required">Government-Issued Photo ID</label>
                        <div class="file-upload-area" id="idVerificationUpload">
                            <div class="file-upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div style="font-weight: 600; margin-bottom: 10px;">Upload Photo ID</div>
                            <div>Drag & drop your files here or click to browse</div>
                            <div class="file-upload-hint">
                                Accepted: JPEG, PNG, PDF (Max 5MB each)
                            </div>
                        </div>
                        <input type="file" id="idVerification" name="idVerification" 
                               accept=".jpg,.jpeg,.png,.pdf" multiple style="display: none;">
                        <div class="file-list" id="idVerificationList">
                            <div class="no-files">No files selected</div>
                        </div>
                        <div class="error-message" id="idVerificationError">
                            <i class="fas fa-exclamation-circle"></i>
                            Please upload a valid photo ID
                        </div>
                    </div>
                    
                    <h3>Co-Applicants</h3>
                    <div class="add-co-applicant" id="addCoApplicant">
                        <i class="fas fa-user-plus"></i>
                        <div style="font-weight: 600;">Add Co-Applicant</div>
                        <div style="font-size: 14px; color: var(--gray); margin-top: 5px;">
                            Spouse, partner, or roommate applying together
                        </div>
                    </div>
                    
                    <div id="coApplicantsContainer"></div>
                    
                    <div class="save-progress">
                        <button type="button" class="save-progress-btn" id="saveProgressBtn">
                            <i class="fas fa-save"></i> Save Progress & Resume Later
                        </button>
                        <div class="field-hint" style="text-align: center; margin-top: 10px;">
                            <i class="fas fa-sync-alt"></i>
                            Auto-saves every 30 seconds
                        </div>
                    </div>
                    
                    <div class="btn-container">
                        <div></div>
                        <button type="button" class="btn-next" onclick="nextSection(1)" id="nextBtn1">
                            Continue to Residency <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 2: Residency & Occupancy -->
                <div class="form-section" id="section2">
                    <h2><i class="fas fa-users"></i> Residency & Occupancy Information</h2>
                    
                    <h3>Occupancy Details</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="numOccupants" class="required">Total Number of Occupants</label>
                            <input type="number" id="numOccupants" name="numOccupants" 
                                   min="1" max="10" value="1" required
                                   data-validation="occupants">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Include all adults, children, and infants
                            </div>
                            <div class="error-message" id="numOccupantsError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid number (1-10)
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="occupantsList" class="required">List All Occupants & Ages</label>
                            <textarea id="occupantsList" name="occupantsList" rows="3" 
                                      placeholder="John Smith (35), Jane Smith (33), Emily Smith (5), Michael Smith (2)" 
                                      maxlength="500" required
                                      data-validation="text"></textarea>
                            <div class="character-count" id="occupantsListCount">0/500 characters</div>
                            <div class="error-message" id="occupantsListError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please list all occupants and their ages
                            </div>
                        </div>
                    </div>
                    
                    <h3>Pet Information</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="hasPets" name="hasPets">
                        <label for="hasPets">Will you have any pets in the unit?</label>
                    </div>
                    
                    <div id="petDetails" style="display: none;">
                        <div class="notice-box">
                            <i class="fas fa-paw"></i>
                            <strong>Pet Policy:</strong> Additional pet fees may apply. Breed restrictions may apply for dogs.
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="petType" class="required">Type of Pet</label>
                                <select id="petType" name="petType" required>
                                    <option value="">Select Type</option>
                                    <option value="Dog">Dog</option>
                                    <option value="Cat">Cat</option>
                                    <option value="Bird">Bird</option>
                                    <option value="Fish">Fish</option>
                                    <option value="Reptile">Reptile</option>
                                    <option value="Small Animal">Small Animal</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label for="petBreed">Breed / Species</label>
                                <input type="text" id="petBreed" name="petBreed" 
                                       placeholder="Labrador, Siamese, etc.">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="petWeight">Weight (lbs)</label>
                                <input type="number" id="petWeight" name="petWeight" 
                                       min="1" max="200" placeholder="50">
                            </div>
                            <div class="form-col">
                                <label for="petAge">Age</label>
                                <input type="number" id="petAge" name="petAge" 
                                       min="0" max="30" placeholder="3">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="petVaccinations">Pet Vaccination Records</label>
                            <div class="file-upload-area" id="petVaccinationsUpload">
                                <div class="file-upload-icon">
                                    <i class="fas fa-file-medical"></i>
                                </div>
                                <div>Upload vaccination records</div>
                                <div class="file-upload-hint">
                                    Required for dogs and cats. Accepted: JPEG, PNG, PDF
                                </div>
                            </div>
                            <input type="file" id="petVaccinations" name="petVaccinations" 
                                   accept=".jpg,.jpeg,.png,.pdf" multiple style="display: none;">
                            <div class="file-list" id="petVaccinationsList">
                                <div class="no-files">No files selected</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="hasServiceAnimal" name="hasServiceAnimal">
                        <label for="hasServiceAnimal">Will you have a service or assistance animal?</label>
                    </div>
                    
                    <div id="serviceAnimalDetails" style="display: none;">
                        <div class="notice-box">
                            <i class="fas fa-universal-access"></i>
                            <strong>Service Animal Information:</strong> Service and assistance animals are not considered pets and are not subject to pet fees or restrictions under the ADA and Fair Housing Act.
                        </div>
                        
                        <div class="form-group">
                            <label for="serviceAnimalTask">Describe the work/task the animal performs</label>
                            <textarea id="serviceAnimalTask" name="serviceAnimalTask" rows="3" 
                                      placeholder="Please describe the specific tasks or work performed by the animal..." 
                                      maxlength="500"></textarea>
                            <div class="character-count" id="serviceAnimalTaskCount">0/500 characters</div>
                        </div>
                    </div>
                    
                    <h3>Current Residence</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="currentAddress" class="required">Current Address</label>
                            <input type="text" id="currentAddress" name="currentAddress" 
                                   placeholder="456 Oak Avenue" required
                                   data-validation="address">
                            <div class="error-message" id="currentAddressError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your current address
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="currentCity" class="required">City</label>
                            <input type="text" id="currentCity" name="currentCity" 
                                   placeholder="Springfield" required>
                            <div class="error-message" id="currentCityError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your current city
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="currentState" class="required">State</label>
                            <select id="currentState" name="currentState" required>
                                <option value="">Select State</option>
                            </select>
                            <div class="error-message" id="currentStateError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please select your current state
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="currentZip" class="required">ZIP Code</label>
                            <input type="text" id="currentZip" name="currentZip" 
                                   placeholder="12345" required
                                   data-validation="zip" maxlength="10">
                            <div class="error-message" id="currentZipError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid ZIP code
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="currentLandlord" class="required">Landlord/Property Manager Name</label>
                            <input type="text" id="currentLandlord" name="currentLandlord" 
                                   placeholder="Robert Johnson" required>
                            <div class="error-message" id="currentLandlordError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your landlord's name
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="currentLandlordContact" class="required">Landlord Contact</label>
                            <input type="text" id="currentLandlordContact" name="currentLandlordContact" 
                                   placeholder="(555) 987-6543" required
                                   data-validation="contact">
                            <div class="error-message" id="currentLandlordContactError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter landlord contact information
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="currentResidenceDates" class="required">Dates of Residence</label>
                            <input type="text" id="currentResidenceDates" name="currentResidenceDates" 
                                   placeholder="MM/YYYY to MM/YYYY" required
                                   data-validation="date-range">
                            <div class="error-message" id="currentResidenceDatesError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your dates of residence
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="currentRent" class="required">Monthly Rent Amount</label>
                            <div style="position: relative;">
                                <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--gray);">$</span>
                                <input type="number" id="currentRent" name="currentRent" 
                                       min="0" step="0.01" placeholder="1500.00" required
                                       style="padding-left: 30px;">
                            </div>
                            <div class="error-message" id="currentRentError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your monthly rent amount
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="currentReasonLeaving" class="required">Reason for Leaving</label>
                        <textarea id="currentReasonLeaving" name="currentReasonLeaving" rows="2" 
                                  placeholder="Relocating for work, need more space, etc." 
                                  maxlength="300" required></textarea>
                        <div class="character-count" id="currentReasonLeavingCount">0/300 characters</div>
                        <div class="error-message" id="currentReasonLeavingError">
                            <i class="fas fa-exclamation-circle"></i>
                            Please provide a reason for leaving
                        </div>
                    </div>
                    
                    <h3>Previous Residence (if less than 2 years at current address)</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="previousAddress">Previous Address</label>
                            <input type="text" id="previousAddress" name="previousAddress" 
                                   placeholder="789 Pine Street">
                        </div>
                        <div class="form-col">
                            <label for="previousCity">City</label>
                            <input type="text" id="previousCity" name="previousCity" 
                                   placeholder="Riverside">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="previousState">State</label>
                            <select id="previousState" name="previousState">
                                <option value="">Select State</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="previousZip">ZIP Code</label>
                            <input type="text" id="previousZip" name="previousZip" 
                                   placeholder="54321" maxlength="10">
                        </div>
                    </div>
                    
                    <div class="save-progress">
                        <button type="button" class="save-progress-btn" id="saveProgressBtn2">
                            <i class="fas fa-save"></i> Save Progress & Resume Later
                        </button>
                    </div>
                    
                    <div class="btn-container">
                        <button type="button" class="btn-prev" onclick="prevSection(2)">
                            <i class="fas fa-arrow-left"></i> Back to Property Info
                        </button>
                        <button type="button" class="btn-next" onclick="nextSection(2)" id="nextBtn2">
                            Continue to Employment <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 3: Employment & Income -->
                <div class="form-section" id="section3">
                    <h2><i class="fas fa-briefcase"></i> Employment & Income Information</h2>
                    
                    <h3>Current Employment</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="employerName" class="required">Employer Name</label>
                            <input type="text" id="employerName" name="employerName" 
                                   placeholder="ABC Corporation" required>
                            <div class="error-message" id="employerNameError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your employer's name
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="employerAddress" class="required">Employer Address</label>
                            <input type="text" id="employerAddress" name="employerAddress" 
                                   placeholder="789 Business Blvd, Suite 100" required>
                            <div class="error-message" id="employerAddressError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your employer's address
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="position" class="required">Position/Title</label>
                            <input type="text" id="position" name="position" 
                                   placeholder="Software Engineer" required>
                            <div class="error-message" id="positionError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your position/title
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="supervisorName" class="required">Supervisor Name</label>
                            <input type="text" id="supervisorName" name="supervisorName" 
                                   placeholder="Sarah Williams" required>
                            <div class="error-message" id="supervisorNameError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your supervisor's name
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="supervisorContact" class="required">Supervisor Contact</label>
                            <input type="text" id="supervisorContact" name="supervisorContact" 
                                   placeholder="(555) 246-8137" required
                                   data-validation="contact">
                            <div class="error-message" id="supervisorContactError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter supervisor contact information
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="employmentStart" class="required">Employment Start Date</label>
                            <input type="date" id="employmentStart" name="employmentStart" 
                                   max="" required>
                            <div class="error-message" id="employmentStartError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your employment start date
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="income" class="required">Monthly Gross Income</label>
                            <div style="position: relative;">
                                <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--gray);">$</span>
                                <input type="number" id="income" name="income" 
                                       min="0" step="0.01" placeholder="5000.00" required
                                       style="padding-left: 30px;">
                            </div>
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Gross income before taxes and deductions
                            </div>
                            <div class="error-message" id="incomeError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter your monthly income
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="incomeFrequency">Income Frequency</label>
                            <select id="incomeFrequency" name="incomeFrequency">
                                <option value="Monthly" selected>Monthly</option>
                                <option value="Bi-weekly">Bi-weekly</option>
                                <option value="Weekly">Weekly</option>
                                <option value="Annually">Annually</option>
                            </select>
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                How often do you receive this income?
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="incomeVerification" class="required">Income Verification Documents</label>
                        <div class="file-upload-area" id="incomeVerificationUpload">
                            <div class="file-upload-icon">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <div style="font-weight: 600; margin-bottom: 10px;">Upload Proof of Income</div>
                            <div>Recent pay stubs, bank statements, or employment verification</div>
                            <div class="file-upload-hint">
                                Last 2-3 months recommended. Max 5MB per file
                            </div>
                        </div>
                        <input type="file" id="incomeVerification" name="incomeVerification" 
                               accept=".jpg,.jpeg,.png,.pdf" multiple style="display: none;">
                        <div class="file-list" id="incomeVerificationList">
                            <div class="no-files">No files selected</div>
                        </div>
                        <div class="error-message" id="incomeVerificationError">
                            <i class="fas fa-exclamation-circle"></i>
                            Please upload proof of income
                        </div>
                    </div>
                    
                    <h3>Additional Income Sources</h3>
                    <div class="form-group">
                        <label for="otherIncome">Other income sources (child support, alimony, investments, social security, pensions, etc.)</label>
                        <textarea id="otherIncome" name="otherIncome" rows="3" 
                                  placeholder="Child support: $500/month, Investment dividends: $200/month, Social Security: $1200/month" 
                                  maxlength="500"></textarea>
                        <div class="character-count" id="otherIncomeCount">0/500 characters</div>
                        <div class="field-hint">
                            <i class="fas fa-info-circle"></i>
                            Include source, amount, and frequency
                        </div>
                    </div>
                    
                    <h3>Previous Employment (if less than 1 year at current job)</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="previousEmployer">Previous Employer</label>
                            <input type="text" id="previousEmployer" name="previousEmployer" 
                                   placeholder="XYZ Company">
                        </div>
                        <div class="form-col">
                            <label for="previousPosition">Position</label>
                            <input type="text" id="previousPosition" name="previousPosition" 
                                   placeholder="Junior Developer">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="previousEmploymentDates">Employment Dates</label>
                            <input type="text" id="previousEmploymentDates" name="previousEmploymentDates" 
                                   placeholder="MM/YYYY to MM/YYYY">
                        </div>
                        <div class="form-col">
                            <label for="previousSupervisor">Supervisor Name</label>
                            <input type="text" id="previousSupervisor" name="previousSupervisor" 
                                   placeholder="Michael Thompson">
                        </div>
                    </div>
                    
                    <div class="save-progress">
                        <button type="button" class="save-progress-btn" id="saveProgressBtn3">
                            <i class="fas fa-save"></i> Save Progress & Resume Later
                        </button>
                    </div>
                    
                    <div class="btn-container">
                        <button type="button" class="btn-prev" onclick="prevSection(3)">
                            <i class="fas fa-arrow-left"></i> Back to Residency
                        </button>
                        <button type="button" class="btn-next" onclick="nextSection(3)" id="nextBtn3">
                            Continue to Financial Info <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 4: Financial & References -->
                <div class="form-section" id="section4">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Financial Details & References</h2>
                    
                    <h3>Financial Information</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="bankName">Bank Name</label>
                            <input type="text" id="bankName" name="bankName" 
                                   placeholder="First National Bank">
                        </div>
                        <div class="form-col">
                            <label for="accountType">Account Type(s)</label>
                            <select id="accountType" name="accountType">
                                <option value="">Select Type</option>
                                <option value="Checking">Checking</option>
                                <option value="Savings">Savings</option>
                                <option value="Both">Both Checking & Savings</option>
                                <option value="Credit Union">Credit Union</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="outstandingDebts">Monthly Debt Obligations</label>
                        <textarea id="outstandingDebts" name="outstandingDebts" rows="3" 
                                  placeholder="Auto loan: $350/month, Student loan: $200/month, Credit cards: $150/month" 
                                  maxlength="500"></textarea>
                        <div class="character-count" id="outstandingDebtsCount">0/500 characters</div>
                        <div class="field-hint">
                            <i class="fas fa-info-circle"></i>
                            List monthly payments for loans, credit cards, child support, etc.
                        </div>
                    </div>
                    
                    <h3>Legal & Background Information</h3>
                    <div class="legal-box">
                        <p><strong>Important:</strong> Providing false information may result in application denial. All information is verified through third-party screening services.</p>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="bankruptcy" name="bankruptcy">
                        <label for="bankruptcy">Have you declared bankruptcy in the past 7 years?</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="evictions" name="evictions">
                        <label for="evictions">Have you been evicted from a rental property in the past 7 years?</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="criminalRecord" name="criminalRecord">
                        <label for="criminalRecord">Do you have any felony convictions that have not been expunged?</label>
                    </div>
                    
                    <div id="legalExplanation" style="display: none;">
                        <div class="form-group">
                            <label for="legalDetails">Please provide details (dates, circumstances, resolution)</label>
                            <textarea id="legalDetails" name="legalDetails" rows="3" 
                                      placeholder="Please explain the circumstances..." 
                                      maxlength="500"></textarea>
                            <div class="character-count" id="legalDetailsCount">0/500 characters</div>
                        </div>
                    </div>
                    
                    <h3>Personal References</h3>
                    <div class="notice-box">
                        <i class="fas fa-user-friends"></i>
                        <strong>Reference Guidelines:</strong> Please provide references who are not relatives and have known you for at least 2 years.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reference1Name" class="required">Reference 1: Full Name</label>
                            <input type="text" id="reference1Name" name="reference1Name" 
                                   placeholder="Michael Brown" required>
                            <div class="error-message" id="reference1NameError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter reference name
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="reference1Relationship" class="required">Relationship</label>
                            <input type="text" id="reference1Relationship" name="reference1Relationship" 
                                   placeholder="Friend, Colleague, etc." required>
                            <div class="error-message" id="reference1RelationshipError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter relationship
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reference1Phone" class="required">Phone Number</label>
                            <input type="tel" id="reference1Phone" name="reference1Phone" 
                                   placeholder="(555) 789-0123" required maxlength="14"
                                   data-validation="phone">
                            <div class="error-message" id="reference1PhoneError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid phone number
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="reference1YearsKnown" class="required">Years Known</label>
                            <input type="number" id="reference1YearsKnown" name="reference1YearsKnown" 
                                   min="1" max="50" placeholder="5" required>
                            <div class="error-message" id="reference1YearsKnownError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter years known
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reference2Name">Reference 2: Full Name</label>
                            <input type="text" id="reference2Name" name="reference2Name" 
                                   placeholder="Jennifer Davis">
                        </div>
                        <div class="form-col">
                            <label for="reference2Relationship">Relationship</label>
                            <input type="text" id="reference2Relationship" name="reference2Relationship" 
                                   placeholder="Colleague, Neighbor, etc.">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reference2Phone">Phone Number</label>
                            <input type="tel" id="reference2Phone" name="reference2Phone" 
                                   placeholder="(555) 456-7890" maxlength="14">
                        </div>
                        <div class="form-col">
                            <label for="reference2YearsKnown">Years Known</label>
                            <input type="number" id="reference2YearsKnown" name="reference2YearsKnown" 
                                   min="0" max="50" placeholder="3">
                        </div>
                    </div>
                    
                    <h3>Emergency Contact</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="emergencyName" class="required">Full Name</label>
                            <input type="text" id="emergencyName" name="emergencyName" 
                                   placeholder="David Wilson" required>
                            <div class="error-message" id="emergencyNameError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter emergency contact name
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="emergencyRelationship" class="required">Relationship</label>
                            <input type="text" id="emergencyRelationship" name="emergencyRelationship" 
                                   placeholder="Brother, Parent, Friend, etc." required>
                            <div class="error-message" id="emergencyRelationshipError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter relationship
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="emergencyPhone" class="required">Phone Number</label>
                            <input type="tel" id="emergencyPhone" name="emergencyPhone" 
                                   placeholder="(555) 321-0987" required maxlength="14"
                                   data-validation="phone">
                            <div class="error-message" id="emergencyPhoneError">
                                <i class="fas fa-exclamation-circle"></i>
                                Please enter a valid phone number
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="emergencyAddress">Address</label>
                            <input type="text" id="emergencyAddress" name="emergencyAddress" 
                                   placeholder="321 Pine Street, Springfield">
                        </div>
                    </div>
                    
                    <div class="save-progress">
                        <button type="button" class="save-progress-btn" id="saveProgressBtn4">
                            <i class="fas fa-save"></i> Save Progress & Resume Later
                        </button>
                    </div>
                    
                    <div class="btn-container">
                        <button type="button" class="btn-prev" onclick="prevSection(4)">
                            <i class="fas fa-arrow-left"></i> Back to Employment
                        </button>
                        <button type="button" class="btn-next" onclick="nextSection(4)" id="nextBtn4">
                            Review & Submit <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 5: Review & Submit -->
                <div class="form-section" id="section5">
                    <h2><i class="fas fa-clipboard-check"></i> Review & Submit Application</h2>
                    
                    <div class="notice-box">
                        <i class="fas fa-check-double"></i>
                        <strong>Final Review:</strong> Please review all information carefully before submitting. You cannot edit the application after submission.
                    </div>
                    
                    <div class="summary-section">
                        <h3>Application Summary</h3>
                        <div id="applicationSummary">
                            <!-- Dynamic content will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="payment-section">
                        <h3>Application Fee Payment</h3>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <div style="font-size: 24px; color: var(--primary); font-weight: 700;">$50</div>
                            <div>
                                <div style="font-weight: 600;">Application Processing Fee</div>
                                <div style="font-size: 14px; color: var(--gray);">Non-refundable â€¢ Required for processing</div>
                            </div>
                        </div>
                        
                        <p style="margin-bottom: 20px;"><strong>Select Payment Method:</strong></p>
                        <div class="payment-options">
                            <div class="payment-option" id="creditCardOption">
                                <i class="fas fa-credit-card"></i>
                                <div style="font-weight: 600; margin-bottom: 5px;">Credit/Debit Card</div>
                                <div style="font-size: 14px; color: var(--gray);">Visa, Mastercard, Discover, Amex</div>
                            </div>
                            <div class="payment-option" id="bankTransferOption">
                                <i class="fas fa-university"></i>
                                <div style="font-weight: 600; margin-bottom: 5px;">Bank Transfer</div>
                                <div style="font-size: 14px; color: var(--gray);">ACH or wire transfer</div>
                            </div>
                        </div>
                        
                        <div id="creditCardDetails" style="display: none; margin-top: 25px;">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="cardNumber" class="required">Card Number</label>
                                    <input type="text" id="cardNumber" name="cardNumber" 
                                           placeholder="1234 5678 9012 3456" maxlength="19"
                                           data-validation="credit-card">
                                </div>
                                <div class="form-col">
                                    <label for="cardName" class="required">Name on Card</label>
                                    <input type="text" id="cardName" name="cardName" 
                                           placeholder="John A. Smith">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="expiryDate" class="required">Expiry Date</label>
                                    <input type="text" id="expiryDate" name="expiryDate" 
                                           placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="form-col">
                                    <label for="cvv" class="required">CVV</label>
                                    <input type="text" id="cvv" name="cvv" 
                                           placeholder="123" maxlength="4">
                                </div>
                            </div>
                        </div>
                        
                        <div id="bankTransferDetails" style="display: none; margin-top: 25px;">
                            <div class="notice-box">
                                <h4 style="margin-top: 0; color: var(--primary);">Bank Transfer Instructions</h4>
                                <p>Please transfer the $50 application fee to:</p>
                                <div style="background: white; padding: 15px; border-radius: var(--border-radius-sm); margin: 15px 0;">
                                    <p><strong>Bank:</strong> First National Bank<br>
                                    <strong>Account Name:</strong> Choice Properties LLC - Application Processing<br>
                                    <strong>Account Number:</strong> 123456789<br>
                                    <strong>Routing Number:</strong> 021000021</p>
                                </div>
                                <p><strong>Important:</strong> Include your full name in the transfer reference/memo field.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="legal-box">
                        <h3><i class="fas fa-gavel"></i> Applicant Certification & Agreement</h3>
                        <p>By submitting this application, I certify that:</p>
                        <ul style="margin: 15px 0 15px 20px;">
                            <li>All information provided is true and complete to the best of my knowledge.</li>
                            <li>False or misleading information may result in denial or lease termination.</li>
                            <li>I authorize Choice Properties to verify all provided information.</li>
                            <li>I consent to credit, criminal, and background checks as permitted by law.</li>
                            <li>I understand the application fee is non-refundable.</li>
                            <li>I have received and acknowledge receipt of the Rental Criteria.</li>
                        </ul>
                        <p><strong>FCRA Notice:</strong> A consumer credit report may be obtained in connection with this application. If so, you have the right to receive a copy of the report.</p>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="applicantSignature" class="required">Electronic Signature</label>
                                <input type="text" id="applicantSignature" name="applicantSignature" 
                                       placeholder="Type your full legal name" required>
                                <div class="error-message" id="applicantSignatureError">
                                    <i class="fas fa-exclamation-circle"></i>
                                    Please provide your electronic signature
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="signatureDate" class="required">Date</label>
                                <input type="date" id="signatureDate" name="signatureDate" required>
                                <div class="error-message" id="signatureDateError">
                                    <i class="fas fa-exclamation-circle"></i>
                                    Please enter the date
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="feeAcknowledged" name="feeAcknowledged" required>
                            <label for="feeAcknowledged">I acknowledge that the $50 application fee is non-refundable</label>
                        </div>
                        <div class="error-message" id="feeAcknowledgedError">
                            <i class="fas fa-exclamation-circle"></i>
                            You must acknowledge the application fee
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="termsAgreed" name="termsAgreed" required>
                            <label for="termsAgreed">I agree to the terms and conditions of this application</label>
                        </div>
                        <div class="error-message" id="termsAgreedError">
                            <i class="fas fa-exclamation-circle"></i>
                            You must agree to the terms and conditions
                        </div>
                    </div>
                    
                    <div class="save-progress">
                        <button type="button" class="save-progress-btn" id="saveProgressBtn5">
                            <i class="fas fa-save"></i> Save Progress & Resume Later
                        </button>
                    </div>
                    
                    <div class="btn-container">
                        <button type="button" class="btn-prev" onclick="prevSection(5)">
                            <i class="fas fa-arrow-left"></i> Back to References
                        </button>
                        <button type="button" class="btn-submit" onclick="submitApplication()" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Submit Application & Pay Fee
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <footer>
            <p style="margin-bottom: 10px;">&copy; 2024 Choice Properties. All rights reserved.</p>
            <p style="font-size: 13px; color: var(--gray);">
                <i class="fas fa-shield-alt"></i> Professional Property Management â€¢ 
                <i class="fas fa-lock"></i> Secure Data Processing â€¢ 
                <i class="fas fa-balance-scale"></i> Equal Housing Opportunity
            </p>
            <p style="font-size: 12px; color: var(--gray); margin-top: 10px;">
                Need help? Contact us at <strong>support@choiceproperties.com</strong> or call <strong>(800) 555-1234</strong>
            </p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            APP_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzSfpSGjm3Clowvk5ueG1OytzEHb7RblNAjXSgc-GQm4AVmCcpBjmRrR9zM7bncUo_SQQ/exec', // REPLACE WITH YOUR URL
            LOCAL_STORAGE_KEY: 'choicePropertiesRentalApp_v2',
            AUTO_SAVE_INTERVAL: 30000, // 30 seconds
            APPLICATION_FEE: 50,
            MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
            ALLOWED_FILE_TYPES: ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'],
            MIN_MOVE_IN_DAYS: 3,
            MIN_AGE: 18
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        const $ = id => document.getElementById(id);
        const $$ = selector => document.querySelector(selector);
        const $$$ = selector => Array.from(document.querySelectorAll(selector));
        
        const formatPhone = (value) => {
            const numbers = value.replace(/\D/g, '');
            if (numbers.length <= 3) return numbers;
            if (numbers.length <= 6) return `(${numbers.slice(0,3)}) ${numbers.slice(3)}`;
            return `(${numbers.slice(0,3)}) ${numbers.slice(3,6)}-${numbers.slice(6,10)}`;
        };

        const formatCurrency = (value) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(value || 0);
        };

        const formatDate = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        // ============================================
        // VALIDATION FUNCTIONS
        // ============================================
        const Validators = {
            email: (value) => {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(value);
            },
            
            phone: (value) => {
                const numbers = value.replace(/\D/g, '');
                return numbers.length === 10;
            },
            
            required: (value) => {
                return value && value.toString().trim().length > 0;
            },
            
            minLength: (value, min) => {
                return value && value.toString().trim().length >= min;
            },
            
            maxLength: (value, max) => {
                return value && value.toString().trim().length <= max;
            },
            
            minValue: (value, min) => {
                const num = parseFloat(value);
                return !isNaN(num) && num >= min;
            },
            
            maxValue: (value, max) => {
                const num = parseFloat(value);
                return !isNaN(num) && num <= max;
            },
            
            futureDate: (value) => {
                const date = new Date(value);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return date >= today;
            },
            
            adultAge: (value) => {
                const birthDate = new Date(value);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age >= CONFIG.MIN_AGE;
            },
            
            zipCode: (value) => {
                const re = /^\d{5}(-\d{4})?$/;
                return re.test(value);
            },
            
            ssn: (value) => {
                if (!value) return true; // Optional
                const re = /^\d{4}$/;
                return re.test(value);
            },
            
            creditCard: (value) => {
                const numbers = value.replace(/\D/g, '');
                return numbers.length >= 13 && numbers.length <= 19;
            },
            
            cvv: (value) => {
                const numbers = value.replace(/\D/g, '');
                return numbers.length >= 3 && numbers.length <= 4;
            },
            
            expiryDate: (value) => {
                const re = /^(0[1-9]|1[0-2])\/([0-9]{2})$/;
                if (!re.test(value)) return false;
                
                const [month, year] = value.split('/');
                const now = new Date();
                const currentYear = now.getFullYear() % 100;
                const currentMonth = now.getMonth() + 1;
                
                if (parseInt(year) < currentYear) return false;
                if (parseInt(year) === currentYear && parseInt(month) < currentMonth) return false;
                return true;
            }
        };

        // ============================================
        // FORM STATE MANAGEMENT
        // ============================================
        class FormState {
            constructor() {
                this.data = {
                    section1: {},
                    section2: {},
                    section3: {},
                    section4: {},
                    section5: {},
                    coApplicants: [],
                    files: {},
                    metadata: {}
                };
                this.initialize();
            }
            
            initialize() {
                this.setupAutoSave();
                this.setupEventListeners();
            }
            
            setupAutoSave() {
                setInterval(() => this.autoSave(), CONFIG.AUTO_SAVE_INTERVAL);
            }
            
            setupEventListeners() {
                // Track all input changes
                $$$('input, select, textarea').forEach(element => {
                    element.addEventListener('input', () => this.autoSave());
                    element.addEventListener('change', () => this.autoSave());
                });
            }
            
            collectSectionData(sectionNumber) {
                const sectionId = `section${sectionNumber}`;
                const section = $(sectionId);
                if (!section) return {};
                
                const data = {};
                const inputs = section.querySelectorAll('input, select, textarea');
                
                inputs.forEach(input => {
                    const name = input.name || input.id;
                    if (!name) return;
                    
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        data[name] = input.checked;
                    } else {
                        data[name] = input.value;
                    }
                });
                
                return data;
            }
            
            updateSection(sectionNumber) {
                this.data[`section${sectionNumber}`] = this.collectSectionData(sectionNumber);
            }
            
            autoSave() {
                const currentSection = this.getCurrentSectionNumber();
                if (currentSection) {
                    this.updateSection(currentSection);
                    this.saveToLocalStorage();
                }
            }
            
            saveToLocalStorage() {
                try {
                    localStorage.setItem(CONFIG.LOCAL_STORAGE_KEY, JSON.stringify({
                        data: this.data,
                        timestamp: new Date().toISOString(),
                        lastSection: this.getCurrentSectionNumber()
                    }));
                } catch (error) {
                    console.error('Failed to save to localStorage:', error);
                }
            }
            
            loadFromLocalStorage() {
                try {
                    const saved = localStorage.getItem(CONFIG.LOCAL_STORAGE_KEY);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.data = parsed.data || {};
                        return parsed;
                    }
                } catch (error) {
                    console.error('Failed to load from localStorage:', error);
                }
                return null;
            }
            
            clearLocalStorage() {
                localStorage.removeItem(CONFIG.LOCAL_STORAGE_KEY);
            }
            
            getCurrentSectionNumber() {
                const activeSection = $$$('.form-section.active')[0];
                if (!activeSection) return 1;
                const match = activeSection.id.match(/section(\d+)/);
                return match ? parseInt(match[1]) : 1;
            }
        }

        // ============================================
        // FILE UPLOAD HANDLER
        // ============================================
        class FileUploadHandler {
            constructor() {
                this.uploads = {};
                this.setupFileUploads();
            }
            
            setupFileUploads() {
                const uploadConfigs = [
                    { areaId: 'idVerificationUpload', inputId: 'idVerification', listId: 'idVerificationList' },
                    { areaId: 'incomeVerificationUpload', inputId: 'incomeVerification', listId: 'incomeVerificationList' },
                    { areaId: 'petVaccinationsUpload', inputId: 'petVaccinations', listId: 'petVaccinationsList' }
                ];
                
                uploadConfigs.forEach(config => this.setupUploadArea(config));
            }
            
            setupUploadArea(config) {
                const area = $(config.areaId);
                const input = $(config.inputId);
                const list = $(config.listId);
                
                if (!area || !input) return;
                
                // Click to select files
                area.addEventListener('click', () => input.click());
                
                // Drag and drop
                area.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    area.classList.add('dragover');
                });
                
                area.addEventListener('dragleave', () => {
                    area.classList.remove('dragover');
                });
                
                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    area.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        input.files = e.dataTransfer.files;
                        this.updateFileList(input, list);
                    }
                });
                
                input.addEventListener('change', () => this.updateFileList(input, list));
                
                // Initialize empty file list display
                this.updateFileList(input, list);
            }
            
            updateFileList(input, list) {
                if (!list) return;
                
                list.innerHTML = '';
                
                if (!input.files || input.files.length === 0) {
                    list.innerHTML = '<div class="no-files" style="text-align: center; color: var(--gray); padding: 20px;">No files selected</div>';
                    return;
                }
                
                Array.from(input.files).forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    item.innerHTML = `
                        <div class="file-item-info">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${this.formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <div class="file-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    list.appendChild(item);
                    
                    // Add remove functionality
                    item.querySelector('.file-remove').addEventListener('click', () => {
                        this.removeFile(input, index);
                        this.updateFileList(input, list);
                    });
                });
            }
            
            removeFile(input, index) {
                const dt = new DataTransfer();
                const files = input.files;
                
                for (let i = 0; i < files.length; i++) {
                    if (i !== index) dt.items.add(files[i]);
                }
                
                input.files = dt.files;
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            validateFiles(files) {
                const errors = [];
                
                Array.from(files).forEach(file => {
                    // Check file size
                    if (file.size > CONFIG.MAX_FILE_SIZE) {
                        errors.push(`${file.name}: File exceeds 5MB limit`);
                    }
                    
                    // Check file type
                    if (!CONFIG.ALLOWED_FILE_TYPES.includes(file.type)) {
                        errors.push(`${file.name}: Invalid file type. Allowed: JPG, PNG, PDF`);
                    }
                });
                
                return errors;
            }
            
            async getFileData(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        resolve({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: e.target.result.split(',')[1]
                        });
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            async getAllFiles() {
                const fileData = {};
                const inputs = [
                    { id: 'idVerification', key: 'idVerification' },
                    { id: 'incomeVerification', key: 'incomeVerification' },
                    { id: 'petVaccinations', key: 'petVaccinations' }
                ];
                
                for (const input of inputs) {
                    const element = $(input.id);
                    if (element && element.files.length > 0) {
                        const files = Array.from(element.files);
                        fileData[input.key] = await Promise.all(
                            files.map(file => this.getFileData(file))
                        );
                    }
                }
                
                return fileData;
            }
        }

        // ============================================
        // FORM VALIDATION
        // ============================================
        class FormValidator {
            validateSection(sectionNumber) {
                const sectionId = `section${sectionNumber}`;
                const section = $(sectionId);
                if (!section) return false;
                
                let isValid = true;
                const requiredFields = section.querySelectorAll('[required]');
                
                requiredFields.forEach(field => {
                    if (!this.validateField(field)) {
                        isValid = false;
                        this.showError(field, this.getErrorMessage(field));
                    } else {
                        this.clearError(field);
                    }
                });
                
                return isValid;
            }
            
            validateField(field) {
                const value = field.value.trim();
                const validationType = field.dataset.validation;
                
                // Required validation
                if (field.required && !Validators.required(value)) {
                    return false;
                }
                
                // Type-specific validations
                switch (validationType) {
                    case 'email':
                        return Validators.email(value);
                    case 'phone':
                        return Validators.phone(value);
                    case 'future-date':
                        return Validators.futureDate(value);
                    case 'adult':
                        return Validators.adultAge(value);
                    case 'zip':
                        return Validators.zipCode(value);
                    case 'ssn':
                        return Validators.ssn(value);
                    case 'credit-card':
                        return Validators.creditCard(value);
                    case 'cvv':
                        return Validators.cvv(value);
                    case 'expiry':
                        return Validators.expiryDate(value);
                    default:
                        return true;
                }
            }
            
            getErrorMessage(field) {
                const validationType = field.dataset.validation;
                
                switch (validationType) {
                    case 'email':
                        return 'Please enter a valid email address';
                    case 'phone':
                        return 'Please enter a valid 10-digit phone number';
                    case 'future-date':
                        return 'Please select a future date';
                    case 'adult':
                        return 'You must be 18 years or older';
                    case 'zip':
                        return 'Please enter a valid ZIP code';
                    case 'ssn':
                        return 'Please enter last 4 digits of SSN';
                    case 'credit-card':
                        return 'Please enter a valid credit card number';
                    case 'cvv':
                        return 'Please enter a valid CVV';
                    case 'expiry':
                        return 'Please enter a valid expiry date';
                    default:
                        return 'This field is required';
                }
            }
            
            showError(field, message) {
                field.classList.add('error');
                
                let errorElement = field.parentElement.querySelector('.error-message');
                if (!errorElement) {
                    errorElement = document.createElement('div');
                    errorElement.className = 'error-message';
                    field.parentElement.appendChild(errorElement);
                }
                
                errorElement.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                errorElement.style.display = 'flex';
            }
            
            clearError(field) {
                field.classList.remove('error');
                const errorElement = field.parentElement.querySelector('.error-message');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
            
            validateAllSections() {
                for (let i = 1; i <= 5; i++) {
                    if (!this.validateSection(i)) {
                        return false;
                    }
                }
                return true;
            }
        }

        // ============================================
        // APPLICATION SUBMISSION
        // ============================================
        class ApplicationSubmitter {
            constructor(formState, fileHandler) {
                this.formState = formState;
                this.fileHandler = fileHandler;
            }
            
            async submit() {
                try {
                    // Validate all sections
                    const validator = new FormValidator();
                    if (!validator.validateAllSections()) {
                        alert('Please fix all errors before submitting.');
                        return false;
                    }
                    
                    // Show loading state
                    this.setLoadingState(true);
                    
                    // Collect all data
                    const applicationData = await this.prepareSubmissionData();
                    
                    // Submit to Google Apps Script
                    const response = await fetch(CONFIG.APP_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(applicationData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.handleSuccess(result);
                        return true;
                    } else {
                        throw new Error(result.error || 'Submission failed');
                    }
                    
                } catch (error) {
                    this.handleError(error);
                    return false;
                } finally {
                    this.setLoadingState(false);
                }
            }
            
            async prepareSubmissionData() {
                // Update all sections
                for (let i = 1; i <= 5; i++) {
                    this.formState.updateSection(i);
                }
                
                // Get files
                const files = await this.fileHandler.getAllFiles();
                
                // Prepare final data
                return {
                    application: this.formState.data,
                    files: files,
                    metadata: {
                        submittedAt: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        ipAddress: await this.getIPAddress(),
                        screenResolution: `${screen.width}x${screen.height}`,
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    }
                };
            }
            
            async getIPAddress() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'unknown';
                }
            }
            
            setLoadingState(isLoading) {
                const submitBtn = $('#submitBtn');
                const buttons = $$$('button');
                
                buttons.forEach(btn => {
                    btn.disabled = isLoading;
                });
                
                if (submitBtn) {
                    if (isLoading) {
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                        submitBtn.classList.add('loading');
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Application & Pay Fee';
                        submitBtn.classList.remove('loading');
                    }
                }
            }
            
            handleSuccess(result) {
                // Clear saved data
                this.formState.clearLocalStorage();
                
                // Hide form, show success message
                const form = $('rentalApplication');
                if (form) form.style.display = 'none';
                
                const successMsg = $('successMessage');
                if (successMsg) {
                    const appId = result.applicationId || `APP-${Date.now()}`;
                    $('#applicationIdDisplay').innerHTML = `
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius-sm); display: inline-block; margin: 15px 0;">
                            <div style="font-size: 14px; color: var(--gray);">Application ID:</div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--primary);">${appId}</div>
                        </div>
                    `;
                    successMsg.style.display = 'block';
                }
                
                // Scroll to success message
                successMsg.scrollIntoView({ behavior: 'smooth' });
                
                // Show confirmation
                alert(`âœ… Application submitted successfully!\n\nApplication ID: ${appId}\n\nA confirmation email has been sent.`);
            }
            
            handleError(error) {
                console.error('Submission error:', error);
                
                let userMessage = 'Submission failed. ';
                
                if (error.message.includes('Failed to fetch')) {
                    userMessage += 'Cannot connect to server. Please check your internet connection.';
                } else if (error.message.includes('CORS')) {
                    userMessage += 'Browser security blocked the request. Please try refreshing.';
                } else if (error.message.includes('429')) {
                    userMessage += 'Too many requests. Please wait a moment.';
                } else {
                    userMessage += error.message;
                }
                
                alert(`âŒ ${userMessage}\n\nPlease try again or contact support.`);
            }
        }

        // ============================================
        // UI COMPONENTS
        // ============================================
        class UIComponents {
            static setupProgressBar() {
                const progressFill = $('#progressFill');
                const updateProgress = () => {
                    const sections = $$$('.form-section');
                    const activeIndex = sections.findIndex(s => s.classList.contains('active'));
                    const progress = Math.round((activeIndex) / (sections.length - 1) * 100);
                    if (progressFill) progressFill.style.width = `${progress}%`;
                    
                    // Update step indicators
                    $$$('.progress-step').forEach((step, index) => {
                        step.classList.remove('active', 'completed');
                        if (index < activeIndex) step.classList.add('completed');
                        if (index === activeIndex) step.classList.add('active');
                    });
                };
                
                // Update on section changes
                const observer = new MutationObserver(updateProgress);
                const sectionsContainer = $('rentalApplication');
                if (sectionsContainer) {
                    observer.observe(sectionsContainer, { 
                        attributes: true, 
                        attributeFilter: ['class'],
                        subtree: true 
                    });
                }
                
                updateProgress();
            }
            
            static setupCharacterCounters() {
                const textareas = $$$('textarea[maxlength]');
                textareas.forEach(textarea => {
                    const counterId = `${textarea.id}Count`;
                    const counter = $(counterId);
                    if (!counter) return;
                    
                    const updateCounter = () => {
                        const length = textarea.value.length;
                        const max = parseInt(textarea.getAttribute('maxlength'));
                        counter.textContent = `${length}/${max} characters`;
                        
                        counter.classList.remove('warning', 'error');
                        if (length > max * 0.9) {
                            counter.classList.add('error');
                        } else if (length > max * 0.75) {
                            counter.classList.add('warning');
                        }
                    };
                    
                    textarea.addEventListener('input', updateCounter);
                    updateCounter(); // Initial update
                });
            }
            
            static setupPhoneFormatting() {
                const phoneFields = $$$('input[type="tel"]');
                phoneFields.forEach(field => {
                    field.addEventListener('input', (e) => {
                        const formatted = formatPhone(e.target.value);
                        if (formatted !== e.target.value) {
                            e.target.value = formatted;
                        }
                    });
                });
            }
            
            static setupDateLimits() {
                // Set min date for move-in (3 days from today)
                const moveInDate = $('#moveInDate');
                if (moveInDate) {
                    const minDate = new Date();
                    minDate.setDate(minDate.getDate() + CONFIG.MIN_MOVE_IN_DAYS);
                    moveInDate.min = minDate.toISOString().split('T')[0];
                }
                
                // Set max date for DOB (18 years ago)
                const dob = $('#dob');
                if (dob) {
                    const maxDate = new Date();
                    maxDate.setFullYear(maxDate.getFullYear() - CONFIG.MIN_AGE);
                    dob.max = maxDate.toISOString().split('T')[0];
                }
                
                // Set max date for employment start (today)
                const employmentStart = $('#employmentStart');
                if (employmentStart) {
                    const today = new Date().toISOString().split('T')[0];
                    employmentStart.max = today;
                }
                
                // Set signature date to today
                const signatureDate = $('#signatureDate');
                if (signatureDate) {
                    signatureDate.value = new Date().toISOString().split('T')[0];
                }
            }
            
            static setupPaymentOptions() {
                const creditCardOption = $('#creditCardOption');
                const bankTransferOption = $('#bankTransferOption');
                const creditCardDetails = $('#creditCardDetails');
                const bankTransferDetails = $('#bankTransferDetails');
                
                if (!creditCardOption || !bankTransferOption) return;
                
                const selectOption = (option) => {
                    [creditCardOption, bankTransferOption].forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    if (option === creditCardOption) {
                        creditCardDetails.style.display = 'block';
                        bankTransferDetails.style.display = 'none';
                    } else {
                        creditCardDetails.style.display = 'none';
                        bankTransferDetails.style.display = 'block';
                    }
                };
                
                creditCardOption.addEventListener('click', () => selectOption(creditCardOption));
                bankTransferOption.addEventListener('click', () => selectOption(bankTransferOption));
                
                // Default to credit card
                selectOption(creditCardOption);
            }
            
            static setupConditionalFields() {
                // Pets checkbox
                const hasPets = $('#hasPets');
                const petDetails = $('#petDetails');
                if (hasPets && petDetails) {
                    hasPets.addEventListener('change', () => {
                        petDetails.style.display = hasPets.checked ? 'block' : 'none';
                    });
                }
                
                // Service animal checkbox
                const hasServiceAnimal = $('#hasServiceAnimal');
                const serviceAnimalDetails = $('#serviceAnimalDetails');
                if (hasServiceAnimal && serviceAnimalDetails) {
                    hasServiceAnimal.addEventListener('change', () => {
                        serviceAnimalDetails.style.display = hasServiceAnimal.checked ? 'block' : 'none';
                    });
                }
                
                // Legal checkboxes
                const legalCheckboxes = ['bankruptcy', 'evictions', 'criminalRecord'];
                const legalExplanation = $('#legalExplanation');
                
                legalCheckboxes.forEach(id => {
                    const checkbox = $(id);
                    if (checkbox && legalExplanation) {
                        checkbox.addEventListener('change', () => {
                            const anyChecked = legalCheckboxes.some(id => $(id)?.checked);
                            legalExplanation.style.display = anyChecked ? 'block' : 'none';
                        });
                    }
                });
            }
            
            static setupCoApplicants() {
                const addButton = $('#addCoApplicant');
                const container = $('#coApplicantsContainer');
                
                if (!addButton || !container) return;
                
                let coApplicantCount = 0;
                
                addButton.addEventListener('click', () => {
                    coApplicantCount++;
                    
                    const section = document.createElement('div');
                    section.className = 'co-applicant-section';
                    section.id = `coApplicant${coApplicantCount}`;
                    
                    section.innerHTML = `
                        <div class="co-applicant-header">
                            <h3>Co-Applicant ${coApplicantCount}</h3>
                            <button type="button" class="remove-co-applicant" onclick="this.closest('.co-applicant-section').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="coFullName${coApplicantCount}" class="required">Full Legal Name</label>
                                <input type="text" id="coFullName${coApplicantCount}" name="coFullName${coApplicantCount}" required>
                            </div>
                            <div class="form-col">
                                <label for="coDob${coApplicantCount}" class="required">Date of Birth</label>
                                <input type="date" id="coDob${coApplicantCount}" name="coDob${coApplicantCount}" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="coDlNumber${coApplicantCount}" class="required">Driver's License / State ID</label>
                                <input type="text" id="coDlNumber${coApplicantCount}" name="coDlNumber${coApplicantCount}" required>
                            </div>
                            <div class="form-col">
                                <label for="coDlState${coApplicantCount}" class="required">Issuing State</label>
                                <select id="coDlState${coApplicantCount}" name="coDlState${coApplicantCount}" required>
                                    <option value="">Select State</option>
                                    ${this.getStateOptions()}
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="coPhone${coApplicantCount}" class="required">Phone Number</label>
                                <input type="tel" id="coPhone${coApplicantCount}" name="coPhone${coApplicantCount}" required>
                            </div>
                            <div class="form-col">
                                <label for="coEmail${coApplicantCount}" class="required">Email Address</label>
                                <input type="email" id="coEmail${coApplicantCount}" name="coEmail${coApplicantCount}" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="coRelationship${coApplicantCount}">Relationship to Primary Applicant</label>
                                <input type="text" id="coRelationship${coApplicantCount}" name="coRelationship${coApplicantCount}">
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(section);
                    
                    // Set up phone formatting for new co-applicant
                    const phoneInput = $(`coPhone${coApplicantCount}`);
                    if (phoneInput) {
                        phoneInput.addEventListener('input', (e) => {
                            const formatted = formatPhone(e.target.value);
                            if (formatted !== e.target.value) {
                                e.target.value = formatted;
                            }
                        });
                    }
                });
            }
            
            static getStateOptions() {
                const states = [
                    "AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA",
                    "KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ",
                    "NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT",
                    "VA","WA","WV","WI","WY","DC"
                ];
                return states.map(state => `<option value="${state}">${state}</option>`).join('');
            }
            
            static populateStateDropdowns() {
                const stateSelects = $$$('select[id$="State"]');
                const states = [
                    "AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA",
                    "KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ",
                    "NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT",
                    "VA","WA","WV","WI","WY","DC"
                ];
                
                stateSelects.forEach(select => {
                    if (select.options.length <= 1) {
                        states.forEach(state => {
                            const option = document.createElement('option');
                            option.value = state;
                            option.textContent = state;
                            select.appendChild(option);
                        });
                    }
                });
            }
            
            static setupSaveProgressButtons() {
                const saveButtons = $$$('.save-progress-btn');
                saveButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const formState = new FormState();
                        formState.saveToLocalStorage();
                        alert('âœ… Progress saved successfully!\n\nYou can return later to complete your application.');
                    });
                });
            }
        }

        // ============================================
        // NAVIGATION FUNCTIONS
        // ============================================
        function nextSection(current) {
            const validator = new FormValidator();
            if (!validator.validateSection(current)) {
                alert('Please fix the errors in this section before continuing.');
                return;
            }
            
            const currentSection = $(`section${current}`);
            const nextSection = $(`section${current + 1}`);
            
            if (currentSection && nextSection) {
                currentSection.classList.remove('active');
                nextSection.classList.add('active');
                nextSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function prevSection(current) {
            const currentSection = $(`section${current}`);
            const prevSection = $(`section${current - 1}`);
            
            if (currentSection && prevSection) {
                currentSection.classList.remove('active');
                prevSection.classList.add('active');
                prevSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // ============================================
        // APPLICATION SUBMISSION FUNCTION
        // ============================================
        async function submitApplication() {
            const formState = new FormState();
            const fileHandler = new FileUploadHandler();
            const submitter = new ApplicationSubmitter(formState, fileHandler);
            
            await submitter.submit();
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing Choice Properties Rental Application...');
            
            // Initialize UI components
            UIComponents.setupProgressBar();
            UIComponents.setupCharacterCounters();
            UIComponents.setupPhoneFormatting();
            UIComponents.setupDateLimits();
            UIComponents.setupPaymentOptions();
            UIComponents.setupConditionalFields();
            UIComponents.setupCoApplicants();
            UIComponents.populateStateDropdowns();
            UIComponents.setupSaveProgressButtons();
            
            // Initialize form state and check for saved data
            const formState = new FormState();
            const savedData = formState.loadFromLocalStorage();
            
            if (savedData) {
                if (confirm('We found a saved application. Would you like to restore it?')) {
                    // Restore form data
                    Object.keys(savedData.data).forEach(sectionKey => {
                        const sectionData = savedData.data[sectionKey];
                        Object.keys(sectionData).forEach(fieldKey => {
                            const field = $(fieldKey);
                            if (field) {
                                if (field.type === 'checkbox') {
                                    field.checked = sectionData[fieldKey];
                                } else {
                                    field.value = sectionData[fieldKey] || '';
                                }
                            }
                        });
                    });
                    
                    // Navigate to last saved section
                    if (savedData.lastSection && savedData.lastSection > 1) {
                        for (let i = 1; i < savedData.lastSection; i++) {
                            nextSection(i);
                        }
                    }
                    
                    alert('âœ… Saved application restored successfully!');
                } else {
                    // Clear saved data if user doesn't want to restore
                    formState.clearLocalStorage();
                }
            }
            
            // Initialize file upload handler
            new FileUploadHandler();
            
            console.log('Application initialized successfully');
        });
    </script>
</body>
</html>